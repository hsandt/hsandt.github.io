<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Crawling side-view character in Unity | Long Nguyen Huu</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Crawling side-view character in Unity" />
<meta name="author" content="Long Nguyen Huu" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Note: this post has been moved from my old website. It was written for Unity 5 but Animation Controller has not changed much since." />
<meta property="og:description" content="Note: this post has been moved from my old website. It was written for Unity 5 but Animation Controller has not changed much since." />
<link rel="canonical" href="https://hsandt.github.io/devlog/2016/12/18/crawling-side-view-character-in-unity.html" />
<meta property="og:url" content="https://hsandt.github.io/devlog/2016/12/18/crawling-side-view-character-in-unity.html" />
<meta property="og:site_name" content="Long Nguyen Huu" />
<meta property="og:image" content="https://hsandt.github.io/assets/pictures/blog/devlog/2016-12-18/thumbnail.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-12-18T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://hsandt.github.io/assets/pictures/blog/devlog/2016-12-18/thumbnail.png" />
<meta property="twitter:title" content="Crawling side-view character in Unity" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Long Nguyen Huu"},"dateModified":"2016-12-18T00:00:00+00:00","datePublished":"2016-12-18T00:00:00+00:00","description":"Note: this post has been moved from my old website. It was written for Unity 5 but Animation Controller has not changed much since.","headline":"Crawling side-view character in Unity","image":"https://hsandt.github.io/assets/pictures/blog/devlog/2016-12-18/thumbnail.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://hsandt.github.io/devlog/2016/12/18/crawling-side-view-character-in-unity.html"},"url":"https://hsandt.github.io/devlog/2016/12/18/crawling-side-view-character-in-unity.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://hsandt.github.io/feed.xml" title="Long Nguyen Huu" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-TKEELY26NL"></script>
<script>
  window['ga-disable-G-TKEELY26NL'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
  window.dataLayer = window.dataLayer || [];
  function gtag(){window.dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TKEELY26NL');
</script>

</head>
<body>
<header class="site-header">

  <div class="wrapper"><div class="site-brand">
      <a class="site-title" rel="author" href="/">Long Nguyen Huu</a>
      <div class="site-subtitle">aka komehara – Game developer</div>
      <div class="social-links"><ul class="social-media-list">
<li>
  <a rel="me" href="https://komehara.itch.io/" target="_blank" title="My games on itch.io">
    
    
    <svg class="svg-icon icon-itchio">
      <use xlink:href="/assets/minima-social-icons.svg#itchio"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://github.com/hsandt" target="_blank" title="My GitHub repositories">
    
    
    <svg class="svg-icon icon-github">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://bitbucket.org/hsandt/" target="_blank" title="My BitBucket repositories">
    
    
    <svg class="svg-icon icon-bitbucket">
      <use xlink:href="/assets/minima-social-icons.svg#bitbucket"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://stackoverflow.com/users/3256073/hsandt" target="_blank" title="My profile on Stack Overflow">
    
    
    <svg class="svg-icon icon-stackoverflow">
      <use xlink:href="/assets/minima-social-icons.svg#stackoverflow"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://twitter.com/n_huulong" target="_blank" title="My posts on Twitter">
    
    
    <svg class="svg-icon icon-twitter">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://mastodon.gamedev.place/@leyn" target="_blank" title="My posts on Mastodon">
    
    
    <svg class="svg-icon icon-mastodon">
      <use xlink:href="/assets/minima-social-icons.svg#mastodon"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://www.youtube.com/channel/UCscc8AXbgMQCjzxsXLVvCsg" target="_blank" title="My videos on YouTube">
    
    
    <svg class="svg-icon icon-youtube">
      <use xlink:href="/assets/minima-social-icons.svg#youtube"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://www.linkedin.com/in/huulong/" target="_blank" title="My profile on LinkedIn">
    
    
    <svg class="svg-icon icon-linkedin">
      <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://ko-fi.com/komehara" target="_blank" title="Donations on Ko-fi">
    
    
    <svg class="svg-icon icon-kofi">
      <use xlink:href="/assets/minima-social-icons.svg#kofi"></use>
    </svg>
  </a>
</li>
</ul>
</div>
    </div><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/portfolio/">Portfolio</a><a class="page-link" href="/blog/">Blog</a><a class="page-link" href="/writing/">Writing</a><a class="page-link" href="/comic-strips/">Comic strips</a><a class="page-link" href="/resume/">Resume</a><a class="page-link" href="/newsletter/">Newsletter</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Crawling side-view character in Unity</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2016-12-18T00:00:00+00:00" itemprop="datePublished">
        Dec 18, 2016
      </time>
      
      <a href="/tags/unity">
        #unity
      </a><a href="/tags/character">
        #character
      </a>
    </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><em>Note: this post has been moved from my old website. It was written for Unity 5 but Animation Controller has not changed much since.</em></p>

<p>I implemented crawling for my human character controller in a cooperative platformer made with Unity, Mars 21.</p>

<p><img src="/assets/pictures/blog/devlog/2016-12-18/Mars-21-v2-crawling.gif" alt="Astronaut crawling" /></p>

<figcaption>Astronaut crawling</figcaption>

<h1 id="structure">Structure</h1>

<p>The controller works with two MonoBehaviour scripts, <code class="language-plaintext highlighter-rouge">AstronautPlayerControl.cs</code> and <code class="language-plaintext highlighter-rouge">AstronautMotor.cs</code>, and an Animator component. The Animator Controller has 2 layers:</p>

<h2 id="motion-layer-for-logic">Motion layer for logic</h2>

<p>The Motion Layer represents the character’s finite-state machine (FSM). A StateBehaviour containing the actual motion logic is added to each state, and all the transitions are immediate (transition time = 0). Below, you can see graph of the sub-state machine “Grounded”, with the grounded sub-states: Idle, Walk (hidden on the right), Turn 180 (for animated 180° turns), Crouched, Crawl and Idle-Crouch transition states.</p>

<p><img src="/assets/pictures/blog/devlog/2016-12-18/Mars-21-v2-character-animator-motion-layer.png" alt="Astronaut Animator Motion Layer Crawl" /></p>

<figcaption>Motion Layer</figcaption>

<p>The Crouched and Crawl state logic is pretty simple. Both StateBehaviours contain the following:</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">override</span> <span class="k">public</span> <span class="k">void</span> <span class="nf">OnStateUpdate</span><span class="p">(</span><span class="n">Animator</span> <span class="n">animator</span><span class="p">,</span> <span class="n">AnimatorStateInfo</span> <span class="n">stateInfo</span><span class="p">,</span> <span class="kt">int</span> <span class="n">layerIndex</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">motor</span><span class="p">.</span><span class="n">isGrounded</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">motor</span><span class="p">.</span><span class="nf">Fall</span><span class="p">();</span>  <span class="c1">// enter Fall state (apply gravity + fall animation)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">control</span><span class="p">.</span><span class="n">continueCrouchIntention</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// is the player still holding D-pad / stick down?</span>
        <span class="n">motor</span><span class="p">.</span><span class="nf">StopCrouching</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">motor</span><span class="p">.</span><span class="nf">MoveCrawling</span><span class="p">(</span><span class="n">control</span><span class="p">.</span><span class="n">moveIntentionVector</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>where control is an <code class="language-plaintext highlighter-rouge">AstronautPlayerControl</code> and motor is an <code class="language-plaintext highlighter-rouge">AstronautMotor</code>. <code class="language-plaintext highlighter-rouge">MoveCrawling()</code> moves the character by setting his velocity as it would with a normal walking 2D character, with 3 main differences:</p>

<ul>
  <li>the character preserves his current direction when moving backward (he does not turn)</li>
  <li>the motion velocity is lower, and even lower when moving backward</li>
  <li>the character starts crawling after any motion in the Crouched state (à la Metal Gear Solid), although this difference is merely visual</li>
</ul>

<p>On the video, the character switches between Idle, IdleToCrouched, Crouched, Crawl and CrouchedToIdle. The transitions between IdleToCrouched and CrouchedToIdle allow the character to quickly interrupt crouching to stand up again smoothly and vice-versa.</p>

<h2 id="animation-layer-for-aesthetics">Animation Layer for aesthetics</h2>

<p>The Animation Layer animates the character model. An animation is attached to each state, and the transitions have short durations (0.1s).</p>

<p><img src="/assets/pictures/blog/devlog/2016-12-18/Mars-21-v2-character-animator-animation-layer.png" alt="Astronaut Animator Animation Layer Crawl" /></p>

<figcaption>Animation Layer</figcaption>

<p>Animations have been downloaded from <a href="https://www.mixamo.com/">mixamo</a> after uploading the character model of the Astronaut.</p>

<h1 id="limitations">Limitations</h1>

<p>This approach has an important drawback: you have to duplicate the structure of the FSM between the two layers. Unity has a feature called <em>Animation layer syncing</em> which allows you to reuse an existing structure on multiple layers, but unfortunately it doesn’t support using different transition times on different layers (0 for the Motion layer and 0.1s for the Animation layer). For my next project, I will probably switch to an FSM completely in code (with my own StateMachine class), only using the Animator for actual animations.</p>

  </div><a class="u-url" href="/devlog/2016/12/18/crawling-side-view-character-in-unity.html" hidden></a>
</article>

      </div>
    </main>
<footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        
        
        <ul class="contact-list">
          <li class="p-name">Long Nguyen Huu</li>
          <li><a class="u-email" href="mailto:n.huu.long@gmail.com">n.huu.long@gmail.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>This website was made with Jekyll and is hosted on GitHub Pages. It uses Google Analytics.</p>
        
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list">
<li>
  <a rel="me" href="https://komehara.itch.io/" target="_blank" title="My games on itch.io">
    
    
    <svg class="svg-icon icon-itchio">
      <use xlink:href="/assets/minima-social-icons.svg#itchio"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://github.com/hsandt" target="_blank" title="My GitHub repositories">
    
    
    <svg class="svg-icon icon-github">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://bitbucket.org/hsandt/" target="_blank" title="My BitBucket repositories">
    
    
    <svg class="svg-icon icon-bitbucket">
      <use xlink:href="/assets/minima-social-icons.svg#bitbucket"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://stackoverflow.com/users/3256073/hsandt" target="_blank" title="My profile on Stack Overflow">
    
    
    <svg class="svg-icon icon-stackoverflow">
      <use xlink:href="/assets/minima-social-icons.svg#stackoverflow"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://twitter.com/n_huulong" target="_blank" title="My posts on Twitter">
    
    
    <svg class="svg-icon icon-twitter">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://mastodon.gamedev.place/@leyn" target="_blank" title="My posts on Mastodon">
    
    
    <svg class="svg-icon icon-mastodon">
      <use xlink:href="/assets/minima-social-icons.svg#mastodon"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://www.youtube.com/channel/UCscc8AXbgMQCjzxsXLVvCsg" target="_blank" title="My videos on YouTube">
    
    
    <svg class="svg-icon icon-youtube">
      <use xlink:href="/assets/minima-social-icons.svg#youtube"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://www.linkedin.com/in/huulong/" target="_blank" title="My profile on LinkedIn">
    
    
    <svg class="svg-icon icon-linkedin">
      <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
    </svg>
  </a>
</li>

<li>
  <a rel="me" href="https://ko-fi.com/komehara" target="_blank" title="Donations on Ko-fi">
    
    
    <svg class="svg-icon icon-kofi">
      <use xlink:href="/assets/minima-social-icons.svg#kofi"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer></body>

</html>
